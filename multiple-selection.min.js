/*! angular-multiple-selection 0.0.5 */
function getSelectableElements(a){for(var b=[],c=a.children(),d=0;d<c.length;d++){var e=angular.element(c[d]);e.scope().isSelectable?b.push(e):e.scope().$id!=a.scope().$id&&e.scope().isSelectableZone===!0||(b=b.concat(getSelectableElements(e)))}return b}function offset(a){var b,c={top:0,left:0},d=a&&a.ownerDocument;return b=d.documentElement,void 0!==typeof a.getBoundingClientRect&&(c=a.getBoundingClientRect()),{top:c.top+(window.pageYOffset||b.scrollTop)-(b.clientTop||0),left:c.left+(window.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}}angular.module("multipleSelection",[]).directive("multipleSelectionItem",["$rootScope",function(a){return{scope:!0,restrict:"A",link:function(b,c,d,e){b.isSelectable=!0,b.isSelected=!1,c.on("mousedown",function(b){if(c.scope().isSelected)(b.ctrlKey||b.metaKey||b.shiftKey)&&(c.scope().isSelected=!1,a.$emit("selection:deselect",d[e].scope()),c.scope().$apply());else{if(!b.ctrlKey&&!b.metaKey&&!b.shiftKey)for(var d=getSelectableElements(c.parent()),e=0;e<d.length;e++)d[e].scope().isSelectable&&d[e].scope().isSelected===!0&&(d[e].scope().isSelected=!1,a.$emit("selection:deselect",d[e].scope()),d[e].scope().$apply());c.scope().isSelected=!0,a.$emit("selection:select",c.scope()),c.scope().$apply()}b.stopPropagation()})}}}]).directive("multipleSelectionZone",["$rootScope","$document",function(a,b){return{scope:!0,restrict:"A",link:function(c,d,e,f){function g(a){return a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:{x:a.clientX+document.documentElement.scrollLeft,y:a.clientY+document.documentElement.scrollTop}}function h(a,b){return(b.beginX<=a.beginX&&a.beginX<=b.endX||a.beginX<=b.beginX&&b.beginX<=a.endX)&&(b.beginY<=a.beginY&&a.beginY<=b.endY||a.beginY<=b.beginY&&b.beginY<=a.endY)}function i(a,b,c,d){var e={};return a>c?(e.beginX=c,e.endX=a):(e.beginX=a,e.endX=c),b>d?(e.beginY=d,e.endY=b):(e.beginY=b,e.endY=d),e}function j(a,b,c,d,e){var f=i(b,c,d,e);m.css({top:f.beginY+"px",left:f.beginX+"px",width:f.endX-f.beginX+"px",height:f.endY-f.beginY+"px"})}function k(b){b.preventDefault();var c=g(b);j(m,n,o,c.x,c.y);for(var e=getSelectableElements(d),f=0;f<e.length;f++)h(i(offset(e[f][0]).left,offset(e[f][0]).top,offset(e[f][0]).left+e[f].prop("offsetWidth"),offset(e[f][0]).top+e[f].prop("offsetHeight")),i(n,o,c.x,c.y))?e[f].scope().isSelected===!1&&(e[f].scope().isSelected=!0,a.$emit("selection:select",e[f].scope()),e[f].scope().$apply()):e[f].scope().isSelected===!0&&(e[f].scope().isSelected=!1,a.$emit("selection:deselect",e[f].scope()),e[f].scope().$apply())}function l(a){a.preventDefault();g(a);m.remove(),b.off("mousemove",k),b.off("mouseup",l)}c.isSelectableZone=!0;var m,n=0,o=0;d.on("mousedown",function(c){c.preventDefault();var e=g(c);if(!c.ctrlKey&&!c.metaKey&&!c.shiftKey)for(var f=getSelectableElements(d),h=0;h<f.length;h++)f[h].scope().isSelected===!0&&(f[h].scope().isSelected=!1,a.$emit("selection:deselect",f[h].scope()),f[h].scope().$apply());n=e.x,o=e.y,m=angular.element("<div></div>").addClass("select-helper"),b.find("body").eq(0).append(m),b.on("mousemove",k),b.on("mouseup",l)})}}}]);
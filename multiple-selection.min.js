/*! angular-multiple-selection 0.0.3 */
function getSelectableElements(e){for(var t=[],o=e.children(),n=0;n<o.length;n++){var c=angular.element(o[n]);c.scope().isSelectable?t.push(c):c.scope().$id!=e.scope().$id&&c.scope().isSelectableZone===!0||(t=t.concat(getSelectableElements(c)))}return t}function offset(e){var t,o={top:0,left:0},n=e&&e.ownerDocument;return t=n.documentElement,void 0!==typeof e.getBoundingClientRect&&(o=e.getBoundingClientRect()),{top:o.top+(window.pageYOffset||t.scrollTop)-(t.clientTop||0),left:o.left+(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}}angular.module("multipleSelection",[]).directive("multipleSelectionItem",["$rootScope",function(e){return{scope:!0,restrict:"A",link:function(t,o){t.isSelectable=!0,t.isSelecting=!1,t.isSelected=!1,o.on("mousedown",function(t){if(o.scope().isSelected)t.ctrlKey&&(o.scope().isSelected=!1,e.$emit("selection:deselect",n[c].scope()),o.scope().$apply());else{if(!t.ctrlKey)for(var n=getSelectableElements(o.parent()),c=0;c<n.length;c++)n[c].scope().isSelectable&&(n[c].scope().isSelecting===!0||n[c].scope().isSelected===!0)&&(n[c].scope().isSelecting=!1,n[c].scope().isSelected=!1,e.$emit("selection:deselect",n[c].scope()),n[c].scope().$apply());o.scope().isSelected=!0,e.$emit("selection:select",o.scope()),o.scope().$apply()}t.stopPropagation()})}}}]).directive("multipleSelectionZone",["$rootScope","$document",function(e,t){return{scope:!0,restrict:"A",link:function(o,n){function c(e,t){return(t.beginX<=e.beginX&&e.beginX<=t.endX||e.beginX<=t.beginX&&t.beginX<=e.endX)&&(t.beginY<=e.beginY&&e.beginY<=t.endY||e.beginY<=t.beginY&&t.beginY<=e.endY)}function i(e,t,o,n){var c={};return e>o?(c.beginX=o,c.endX=e):(c.beginX=e,c.endX=o),t>n?(c.beginY=n,c.endY=t):(c.beginY=t,c.endY=n),c}function s(e,t,o,n,c){var s=i(t,o,n,c);f.css({top:s.beginY+"px",left:s.beginX+"px",width:s.endX-s.beginX+"px",height:s.endY-s.beginY+"px"})}function l(t){t.preventDefault(),s(f,g,r,t.pageX,t.pageY);for(var o=getSelectableElements(n),l=0;l<o.length;l++)c(i(offset(o[l][0]).left,offset(o[l][0]).top,offset(o[l][0]).left+o[l].prop("offsetWidth"),offset(o[l][0]).top+o[l].prop("offsetHeight")),i(g,r,t.pageX,t.pageY))?o[l].scope().isSelecting===!1&&(o[l].scope().isSelecting=!0,e.$emit("selection:select",o[l].scope()),o[l].scope().$apply()):o[l].scope().isSelecting===!0&&(o[l].scope().isSelecting=!1,e.$emit("selection:deselect",o[l].scope()),o[l].scope().$apply())}function p(e){e.preventDefault(),f.remove();for(var o=getSelectableElements(n),s=0;s<o.length;s++)o[s].scope().isSelecting===!0?(o[s].scope().isSelecting=!1,o[s].scope().isSelected=e.ctrlKey?!o[s].scope().isSelected:!0,o[s].scope().$apply()):c(i(o[s].prop("offsetLeft"),o[s].prop("offsetTop"),o[s].prop("offsetLeft")+o[s].prop("offsetWidth"),o[s].prop("offsetTop")+o[s].prop("offsetHeight")),i(e.pageX,e.pageY,e.pageX,e.pageY))&&o[s].scope().isSelected===!1&&(o[s].scope().isSelected=!0,o[s].scope().$apply());t.off("mousemove",l),t.off("mouseup",p)}o.isSelectableZone=!0;var f,g=0,r=0;n.on("mousedown",function(o){if(o.preventDefault(),!o.ctrlKey)for(var c=getSelectableElements(n),i=0;i<c.length;i++)(c[i].scope().isSelecting===!0||c[i].scope().isSelected===!0)&&(c[i].scope().isSelecting=!1,c[i].scope().isSelected=!1,e.$emit("selection:deselect",c[i].scope()),c[i].scope().$apply());g=o.pageX,r=o.pageY,f=angular.element("<div></div>").addClass("select-helper"),t.find("body").eq(0).append(f),t.on("mousemove",l),t.on("mouseup",p)})}}}]);
